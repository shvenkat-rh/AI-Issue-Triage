# üîç Gemini Issue Analyzer

An AI-powered issue analysis tool that uses Google's Gemini AI to perform comprehensive analysis of software issues based on your codebase content.

## Features

- **ü§ñ AI-Powered Analysis**: Uses Google Gemini 2.0 Flash for intelligent issue analysis with the latest [Google Gen AI SDK](https://googleapis.github.io/python-genai/)
- **üîç Root Cause Analysis**: Identifies primary causes and contributing factors
- **üí° Solution Generation**: Proposes specific code changes with rationale
- **üè∑Ô∏è Issue Triage**: Automatically classifies issues as bugs, enhancements, or feature requests
- **üìä Severity Assessment**: Rates issues from low to critical priority
- **üéØ Code Location Mapping**: Identifies relevant files, functions, and classes
- **üì§ Export Capabilities**: Export analysis results in JSON format
- **‚ö° Enhanced Performance**: Faster analysis with the latest Gemini 2.0 Flash model

## Setup

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

### 2. Get Gemini API Key

1. Visit [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Create a new API key
3. Copy the `env_example.txt` to `.env` and add your API key:

```bash
cp env_example.txt .env
# Edit .env and add your API key
```

**Note**: The application now uses the latest [Google Gen AI SDK](https://googleapis.github.io/python-genai/) with the advanced `gemini-2.0-flash-001` model for faster and more accurate analysis.

### 3. Prepare Your Codebase

By default, the analyzer looks for a `repomix-output.txt` file in the project directory. This file should contain your codebase content generated by [Repomix](https://github.com/yamadashy/repomix).

To generate this file:
```bash
# Install repomix
npm install -g repomix

# Generate codebase file in your project directory
repomix --output repomix-output.txt
```

**Alternative**: You can use any text file containing your codebase content and specify its path using the `--source-path` option (see CLI usage below).

## Usage

### Web Interface

```bash
streamlit run app.py
```

This will open a web interface where you can:

1. **Enter your Gemini API key** in the sidebar
2. **Provide issue details**:
   - Issue Title
   - Detailed Description
3. **Click "Analyze Issue"** to get comprehensive analysis
4. **Review results** including:
   - Issue classification and severity
   - Root cause analysis
   - Proposed solutions with code changes
   - Confidence score
5. **Export results** as JSON for further use

### Command Line Interface (CLI)

The analyzer also provides a powerful command-line interface for automation and scripting:

#### Quick Start
```bash
# Interactive mode - prompts for title and description
python cli.py

# Direct analysis
python cli.py --title "Login bug" --description "Users can't login on mobile devices"

# Analyze from file
python cli.py --file sample_issue.txt

# Use custom source of truth file
python cli.py --title "Bug" --description "Description" --source-path /path/to/my-codebase.txt

# Save output to file
python cli.py --title "Bug" --description "Description" --output analysis.txt

# JSON output for automation
python cli.py --title "Bug" --description "Description" --format json

# Quiet mode (no progress messages)
python cli.py --quiet --title "Bug" --description "Description"
```

#### CLI Options
```
positional arguments:
  none

options:
  -h, --help            show this help message and exit
  --title TITLE, -t TITLE
                        Issue title
  --description DESCRIPTION, -d DESCRIPTION
                        Issue description  
  --file FILE, -f FILE  Read issue from file (title on first line, description below)
  --output OUTPUT, -o OUTPUT
                        Output file (default: stdout)
  --format {text,json}  Output format (default: text)
  --source-path SOURCE_PATH, -s SOURCE_PATH
                        Path to source of truth file (default: repomix-output.txt)
  --api-key API_KEY     Gemini API key (default: from GEMINI_API_KEY env var)
  --quiet, -q           Suppress progress messages
  --version             show program's version number and exit
```

#### File Format for --file option
```
Issue Title Here
Issue description starts here.
Can be multiple lines.
Include all relevant details.
```

### Command Line Usage (Programmatic)

You can also use the analyzer programmatically:

```python
from gemini_analyzer import GeminiIssueAnalyzer

# Initialize analyzer with default source path
analyzer = GeminiIssueAnalyzer(api_key="your-api-key")

# Or initialize with custom source path
analyzer = GeminiIssueAnalyzer(
    api_key="your-api-key",
    source_path="/path/to/your/codebase.txt"
)

# Note: The analyzer now uses the Google Gen AI SDK with gemini-2.0-flash-001

# Analyze an issue
analysis = analyzer.analyze_issue(
    title="Login page crashes on mobile",
    issue_description="When users try to login on mobile devices, the app crashes..."
)

print(f"Issue Type: {analysis.issue_type}")
print(f"Severity: {analysis.severity}")
print(f"Root Cause: {analysis.root_cause_analysis.primary_cause}")
```

## Source of Truth Configuration

The analyzer uses a "source of truth" file containing your codebase content to perform intelligent analysis. This gives the AI context about your specific code structure, patterns, and implementation details.

### Default Behavior
- By default, the analyzer looks for `repomix-output.txt` in the current directory
- This file should contain your complete codebase content

### Custom Source Path
You can specify a different source file using the `--source-path` option:

```bash
# Use a custom codebase file
python cli.py --source-path /path/to/my-project-dump.txt --title "Issue" --description "Details"

# Use a file in a different directory
python cli.py -s ../other-project/codebase.txt --title "Issue" --description "Details"
```

### Supported File Formats
- Any plain text file containing your codebase
- Generated by tools like [Repomix](https://github.com/yamadashy/repomix)
- Manual concatenation of source files
- Output from other code analysis tools

### Best Practices
- Include all relevant source files in your source of truth
- Keep the file updated when your codebase changes
- Consider excluding large binary files or dependencies
- Include configuration files, documentation, and tests for better analysis

## Analysis Components

### Issue Classification
- **Bug**: Issues that represent errors or defects
- **Enhancement**: Improvements to existing functionality
- **Feature Request**: New functionality requests

### Severity Levels
- **Critical**: System-breaking issues requiring immediate attention
- **High**: Important issues affecting core functionality
- **Medium**: Moderate impact issues
- **Low**: Minor issues with minimal impact

### Root Cause Analysis
- Primary cause identification
- Contributing factors
- Affected components
- Related code locations

### Solution Proposals
- Specific code changes
- Implementation rationale
- Target locations (files, functions, classes)
- Step-by-step implementation guidance

## Example Analysis

```json
{
  "title": "Authentication timeout not handled properly",
  "issue_type": "bug",
  "severity": "high",
  "root_cause_analysis": {
    "primary_cause": "Missing timeout exception handling in auth module",
    "contributing_factors": [
      "No retry mechanism implemented",
      "User feedback on timeout missing"
    ],
    "affected_components": ["authentication", "user_session"],
    "related_code_locations": [
      {
        "file_path": "src/auth/login.py",
        "line_number": 45,
        "function_name": "authenticate_user"
      }
    ]
  },
  "proposed_solutions": [
    {
      "description": "Add timeout exception handling with user feedback",
      "code_changes": "try:\n    response = auth_request()\nexcept TimeoutError:\n    return {'error': 'Authentication timeout'}",
      "location": {
        "file_path": "src/auth/login.py",
        "function_name": "authenticate_user"
      },
      "rationale": "Provides graceful error handling and user feedback"
    }
  ],
  "confidence_score": 0.85
}
```

## Project Structure

```
Gemini-Issue/
‚îú‚îÄ‚îÄ app.py                 # Streamlit web interface
‚îú‚îÄ‚îÄ gemini_analyzer.py     # Core analyzer class
‚îú‚îÄ‚îÄ models.py              # Pydantic data models
‚îú‚îÄ‚îÄ requirements.txt       # Python dependencies
‚îú‚îÄ‚îÄ .gitignore            # Git ignore patterns
‚îú‚îÄ‚îÄ env_example.txt       # Environment variables template
‚îú‚îÄ‚îÄ README.md             # This file
‚îî‚îÄ‚îÄ repomix-output.txt    # Your codebase content (generated)
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

This project is open source and available under the MIT License.

## Support

For issues and questions:
1. Check the existing issues
2. Create a new issue with detailed description
3. Include your environment details and error messages

---

**Note**: This tool requires a valid Google Gemini API key. Usage may incur costs based on Google's pricing for the Gemini API.
